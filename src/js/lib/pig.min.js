!function(t){"use strict";function i(t,i,e){var s="#"+t+" {  position: relative;}."+i+"-figure {  overflow: hidden;  left: 0;  position: absolute;  top: 0;  margin: 0;}."+i+"-figure img {  left: 0;  position: absolute;  top: 0;  height: 100%;  opacity: 0;  transition: "+e/1e3+"s ease opacity;  -webkit-transition: "+e/1e3+"s ease opacity;}."+i+"-figure img."+i+"-thumbnail {  -webkit-filter: blur(30px);  filter: blur(30px);  left: auto;  position: relative;  width: auto;}."+i+"-figure img."+i+"-loaded {  opacity: 1;}",n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=s:a.appendChild(document.createTextNode(s)),n.appendChild(a)}function e(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])}function s(t,s){return this.inRAF=!1,this.isTransitioning=!1,this.minAspectRatioRequiresTransition=!1,this.minAspectRatio=null,this.latestYOffset=0,this.lastWindowWidth=window.innerWidth,this.scrollDirection="down",this.visibleImages=[],this.settings={containerId:"pig",classPrefix:"pig",figureTagName:"figure",spaceBetweenImages:8,transitionSpeed:500,primaryImageBufferHeight:1e3,secondaryImageBufferHeight:300,thumbnailSize:20,urlForSize:function(t,i){return"/img/"+i+"/"+t},getMinAspectRatio:function(t){return 640>=t?2:1280>=t?4:1920>=t?5:6},getImageSize:function(t){return 640>=t?100:1920>=t?250:500}},e(this.settings,s||{}),this.container=document.getElementById(this.settings.containerId),this.container||console.error("Could not find element with ID "+this.settings.containerId),this.images=this._parseImageData(t),i(this.settings.containerId,this.settings.classPrefix,this.settings.transitionSpeed),this}function n(t,i,e){return this.existsOnPage=!1,this.aspectRatio=t.aspectRatio,this.filename=t.filename,this.index=i,this.pig=e,this.classNames={figure:e.settings.classPrefix+"-figure",thumbnail:e.settings.classPrefix+"-thumbnail",loaded:e.settings.classPrefix+"-loaded"},this}var a=function(){function t(){s||(s=!0,window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,66))}function i(){e.forEach(function(t){t()}),s=!1}var e=[],s=!1;return{add:function(i){e.length||window.addEventListener("resize",t),e.push(i)},disable:function(){window.removeEventListener("resize",t)},reEnable:function(){window.addEventListener("resize",t)}}}();s.prototype._getTransitionTimeout=function(){var t=1.5;return this.settings.transitionSpeed*t},s.prototype._getTransitionString=function(){return this.isTransitioning?this.settings.transitionSpeed/1e3+"s transform ease":"none"},s.prototype._recomputeMinAspectRatio=function(){var t=this.minAspectRatio;this.minAspectRatio=this.settings.getMinAspectRatio(this.lastWindowWidth),null!==t&&t!==this.minAspectRatio?this.minAspectRatioRequiresTransition=!0:this.minAspectRatioRequiresTransition=!1},s.prototype._parseImageData=function(t){var i=[];return t.forEach(function(t,e){var s=new n(t,e,this);i.push(s)}.bind(this)),i},s.prototype._computeLayout=function(){var t=parseInt(this.container.clientWidth),i=[],e=0,s=0,n=0;this._recomputeMinAspectRatio(),!this.isTransitioning&&this.minAspectRatioRequiresTransition&&(this.isTransitioning=!0,setTimeout(function(){this.isTransitioning=!1},this._getTransitionTimeout()));var a=this._getTransitionString();[].forEach.call(this.images,function(o,h){if(n+=parseFloat(o.aspectRatio),i.push(o),n>=this.minAspectRatio||h+1===this.images.length){var r=t-this.settings.spaceBetweenImages*(i.length-1),l=r/n;i.forEach(function(t){var i=l*t.aspectRatio;t.style={width:parseInt(i),height:parseInt(l),translateX:e,translateY:s,transition:a},e+=i+this.settings.spaceBetweenImages}.bind(this)),i=[],n=0,s+=parseInt(l)+this.settings.spaceBetweenImages,e=0}}.bind(this)),this.totalHeight=s-this.settings.spaceBetweenImages},s.prototype._doLayout=function(){this.container.style.height=this.totalHeight+"px";var t="up"===this.scrollDirection?this.settings.primaryImageBufferHeight:this.settings.secondaryImageBufferHeight,i="down"===this.scrollDirection?this.settings.secondaryImageBufferHeight:this.settings.primaryImageBufferHeight,e=this.container.offsetTop,s=window.innerHeight,n=this.latestYOffset-e-t,a=this.latestYOffset+s+i;this.images.forEach(function(t){t.style.translateY+t.style.height<n||t.style.translateY>a?t.hide():t.load()}.bind(this))},s.prototype._getOnScroll=function(){var t=this,i=function(){var i=window.pageYOffset;t.previousYOffset=t.latestYOffset||i,t.latestYOffset=i,t.scrollDirection=t.latestYOffset>t.previousYOffset?"down":"up",t.inRAF||(t.inRAF=!0,window.requestAnimationFrame(function(){t._doLayout(),t.inRAF=!1}))};return i},s.prototype.enable=function(){return this.onScroll=this._getOnScroll(),window.addEventListener("scroll",this.onScroll),this.onScroll(),this._computeLayout(),this._doLayout(),a.add(function(){this.lastWindowWidth=window.innerWidth,this._computeLayout(),this._doLayout()}.bind(this)),this},s.prototype.disable=function(){return window.removeEventListener("scroll",this.onScroll),a.disable(),this},n.prototype.load=function(){this.existsOnPage=!0,this._updateStyles(),this.pig.container.appendChild(this.getElement()),setTimeout(function(){this.existsOnPage&&(this.thumbnail||(this.thumbnail=new Image,this.thumbnail.src=this.pig.settings.urlForSize(this.filename,this.pig.settings.thumbnailSize),this.thumbnail.className=this.classNames.thumbnail,this.thumbnail.onload=function(){this.thumbnail&&(this.thumbnail.className+=" "+this.classNames.loaded)}.bind(this),this.getElement().appendChild(this.thumbnail)),this.fullImage||(this.fullImage=new Image,this.fullImage.src=this.pig.settings.urlForSize(this.filename,this.pig.settings.getImageSize(this.pig.lastWindowWidth)),this.fullImage.onload=function(){this.fullImage&&(this.fullImage.className+=" "+this.classNames.loaded)}.bind(this),this.getElement().appendChild(this.fullImage)))}.bind(this),100)},n.prototype.hide=function(){this.getElement()&&(this.thumbnail&&(this.thumbnail.src="",this.getElement().removeChild(this.thumbnail),delete this.thumbnail),this.fullImage&&(this.fullImage.src="",this.getElement().removeChild(this.fullImage),delete this.fullImage)),this.existsOnPage&&this.pig.container.removeChild(this.getElement()),this.existsOnPage=!1},n.prototype.getElement=function(){return this.element||(this.element=document.createElement(this.pig.settings.figureTagName),this.element.className=this.classNames.figure,this._updateStyles()),this.element},n.prototype._updateStyles=function(){this.getElement().style.transition=this.style.transition,this.getElement().style.width=this.style.width+"px",this.getElement().style.height=this.style.height+"px",this.getElement().style.transform="translate3d("+this.style.translateX+"px,"+this.style.translateY+"px, 0)"},"function"==typeof define&&define.amd?define(s):"undefined"!=typeof module&&module.exports?module.exports=s:t.Pig=s}(this);